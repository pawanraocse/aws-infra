â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           EXTERNAL LAYER                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                            â”‚
â”‚  â”‚   Angular    â”‚  User Interface (Port 4200)                               â”‚
â”‚  â”‚   Frontend   â”‚  - Login/Signup UI                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  - Dashboard & CRUD Operations                            â”‚
â”‚         â”‚          - HTTP Client with JWT Bearer Token                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”‚ HTTP + JWT Token
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         API GATEWAY LAYER (Port 8080)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Spring Cloud Gateway                                               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  1. JWT Validation (Cognito JWKS)                            â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  2. Extract tenant_id from cognito:groups                    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  3. Add Headers: X-Tenant-Id, X-User-Id, X-Authorities       â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  4. Circuit Breaker & Retry Logic                            â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  5. CORS Configuration                                        â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  Routes:                                                            â”‚    â”‚
â”‚  â”‚  â€¢ /auth/**  â†’ lb://auth-service                                   â”‚    â”‚
â”‚  â”‚  â€¢ /api/**   â†’ lb://backend-service                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                   â”‚
â”‚                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SERVICE REGISTRY     â”‚          â”‚     MICROSERVICES LAYER                   â”‚
â”‚  (Port 8761)          â”‚          â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Eureka Server   â”‚â—„â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¤  All services register here        â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚          â”‚  â”‚  with heartbeat every 30s           â”‚  â”‚
â”‚  â”‚ - Service       â”‚  â”‚          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚   Discovery     â”‚  â”‚          â”‚                                           â”‚
â”‚  â”‚ - Health Checks â”‚  â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ - Load Balancer â”‚  â”‚          â”‚  â”‚  Auth-Service (Port 8081)          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚  â”‚  â”‚ â€¢ OAuth2 Client (Cognito)    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Login/Signup/Logout        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ JWT Token Management       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ User Registration          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Tenant Provisioning Triggerâ”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Backend-Service (Port 8082)       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Multi-Tenant Data Access   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Schema-per-Tenant          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ CRUD APIs                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Business Logic             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Admin Tenant Provisioning  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATA LAYER                â”‚                          â”‚
â”‚                                                   â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PostgreSQL Database (Port 5432)                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Database: awsinfra                                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  public schema (System Tables)                           â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ tenants (tenant registry)                             â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ tenant_audit_log                                      â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  tenant_acme schema (Tenant ACME data)                   â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ entries                                               â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ notes                                                 â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ ... (all business tables)                            â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  tenant_xyz schema (Tenant XYZ data)                     â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ entries                                               â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ notes                                                 â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        EXTERNAL SERVICES                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  AWS Cognito                                                       â”‚     â”‚
â”‚  â”‚  â€¢ User Pool (Authentication)                                      â”‚     â”‚
â”‚  â”‚  â€¢ User Groups (tenant_acme, tenant_xyz)                          â”‚     â”‚
â”‚  â”‚  â€¢ JWKS Endpoint (JWT validation)                                 â”‚     â”‚
â”‚  â”‚  â€¢ OAuth2 Authorization Server                                    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Complete End-to-End Flows

### **Flow 1: New Tenant Signup** (One-time setup)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Angular  â”‚    â”‚ Gateway â”‚    â”‚   Auth   â”‚    â”‚ Cognito â”‚    â”‚ Backend  â”‚
â”‚ Frontend â”‚    â”‚ Service â”‚    â”‚ Service  â”‚    â”‚         â”‚    â”‚ Service  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
â”‚               â”‚              â”‚               â”‚               â”‚
â”‚ 1. POST /auth/signup         â”‚               â”‚               â”‚
â”‚ {email, password,            â”‚               â”‚               â”‚
â”‚  companyName: "Acme Corp"}   â”‚               â”‚               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚               â”‚               â”‚
â”‚               â”‚              â”‚               â”‚               â”‚
â”‚               â”‚ 2. Route to auth-service     â”‚               â”‚
â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚               â”‚
â”‚               â”‚              â”‚               â”‚               â”‚
â”‚               â”‚              â”‚ 3. Create user in Cognito     â”‚
â”‚               â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚
â”‚               â”‚              â”‚               â”‚               â”‚
â”‚               â”‚              â”‚ 4. User created (user-uuid)   â”‚
â”‚               â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
â”‚               â”‚              â”‚               â”‚               â”‚
â”‚               â”‚              â”‚ 5. POST /api/admin/tenants   â”‚
â”‚               â”‚              â”‚ {tenantId: "acme",           â”‚
â”‚               â”‚              â”‚  tenantName: "Acme Corp"}    â”‚
â”‚               â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
â”‚               â”‚              â”‚               â”‚               â”‚
â”‚               â”‚              â”‚               â”‚ 6. Create tenant record
â”‚               â”‚              â”‚               â”‚    in public.tenants
â”‚               â”‚              â”‚               â”‚               â”‚
â”‚               â”‚              â”‚               â”‚ 7. CREATE SCHEMA
â”‚               â”‚              â”‚               â”‚    tenant_acme
â”‚               â”‚              â”‚               â”‚               â”‚
â”‚               â”‚              â”‚               â”‚ 8. Run Flyway migrations
â”‚               â”‚              â”‚               â”‚    in tenant_acme schema
â”‚               â”‚              â”‚               â”‚    (creates entries table)
â”‚               â”‚              â”‚               â”‚               â”‚
â”‚               â”‚              â”‚ 9. Tenant provisioned         â”‚
â”‚               â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚               â”‚              â”‚               â”‚               â”‚
â”‚               â”‚              â”‚ 10. Create Cognito group      â”‚
â”‚               â”‚              â”‚     "tenant_acme"             â”‚
â”‚               â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚
â”‚               â”‚              â”‚               â”‚               â”‚
â”‚               â”‚              â”‚ 11. Add user to group         â”‚
â”‚               â”‚              â”‚     "tenant_acme"             â”‚
â”‚               â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚
â”‚               â”‚              â”‚               â”‚               â”‚
â”‚               â”‚ 12. Signup successful        â”‚               â”‚
â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚               â”‚
â”‚               â”‚              â”‚               â”‚               â”‚
â”‚ 13. Success  â”‚               â”‚               â”‚               â”‚
â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚               â”‚               â”‚
â”‚               â”‚              â”‚               â”‚               â”‚
```

---

### **Flow 2: User Login** (Existing tenant)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Angular  â”‚    â”‚ Gateway â”‚    â”‚   Auth   â”‚    â”‚ Cognito â”‚
â”‚ Frontend â”‚    â”‚ Service â”‚    â”‚ Service  â”‚    â”‚         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
â”‚               â”‚              â”‚               â”‚
â”‚ 1. POST /auth/login          â”‚               â”‚
â”‚ {email, password}            â”‚               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚               â”‚
â”‚               â”‚              â”‚               â”‚
â”‚               â”‚ 2. Route to auth-service     â”‚
â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚
â”‚               â”‚              â”‚               â”‚
â”‚               â”‚              â”‚ 3. Authenticate user
â”‚               â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
â”‚               â”‚              â”‚               â”‚
â”‚               â”‚              â”‚ 4. Return JWT token
â”‚               â”‚              â”‚    Claims:    â”‚
â”‚               â”‚              â”‚    - sub: user-uuid
â”‚               â”‚              â”‚    - cognito:groups:
â”‚               â”‚              â”‚      ["tenant_acme"]
â”‚               â”‚              â”‚    - email    â”‚
â”‚               â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚               â”‚              â”‚               â”‚
â”‚               â”‚ 5. Return JWT to gateway     â”‚
â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
â”‚               â”‚              â”‚               â”‚
â”‚ 6. JWT Token â”‚               â”‚               â”‚
â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚               â”‚
â”‚               â”‚              â”‚               â”‚
â”‚ 7. Store JWT in localStorage â”‚               â”‚
â”‚               â”‚              â”‚               â”‚
```

---

### **Flow 3: CRUD Operation** (Authenticated request)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Angular  â”‚    â”‚ Gateway â”‚    â”‚ Backend  â”‚    â”‚PostgreSQLâ”‚
â”‚ Frontend â”‚    â”‚ Service â”‚    â”‚ Service  â”‚    â”‚          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
â”‚               â”‚              â”‚               â”‚
â”‚ 1. POST /api/entries         â”‚               â”‚
â”‚ Authorization: Bearer <JWT>  â”‚               â”‚
â”‚ {key: "api_key",             â”‚               â”‚
â”‚  value: "sk-123"}            â”‚               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚               â”‚
â”‚               â”‚              â”‚               â”‚
â”‚               â”‚ 2. Validate JWT signature    â”‚
â”‚               â”‚    using Cognito JWKS        â”‚
â”‚               â”‚              â”‚               â”‚
â”‚               â”‚ 3. Extract from JWT:         â”‚
â”‚               â”‚    - tenant_id: "acme"       â”‚
â”‚               â”‚    - user_id: "user-uuid"    â”‚
â”‚               â”‚    - email: "user@acme.com"  â”‚
â”‚               â”‚              â”‚               â”‚
â”‚               â”‚ 4. Add headers & route       â”‚
â”‚               â”‚    X-Tenant-Id: acme         â”‚
â”‚               â”‚    X-User-Id: user-uuid      â”‚
â”‚               â”‚    X-Email: user@acme.com    â”‚
â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚
â”‚               â”‚              â”‚               â”‚
â”‚               â”‚              â”‚ 5. TenantContextFilter
â”‚               â”‚              â”‚    reads headers
â”‚               â”‚              â”‚    TenantContext.setTenantId("acme")
â”‚               â”‚              â”‚               â”‚
â”‚               â”‚              â”‚ 6. Hibernate resolves
â”‚               â”‚              â”‚    schema: tenant_acme
â”‚               â”‚              â”‚               â”‚
â”‚               â”‚              â”‚ 7. INSERT INTO
â”‚               â”‚              â”‚    tenant_acme.entries
â”‚               â”‚              â”‚    (key, value, ...)
â”‚               â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
â”‚               â”‚              â”‚               â”‚
â”‚               â”‚              â”‚ 8. Row inserted
â”‚               â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚               â”‚              â”‚               â”‚
â”‚               â”‚ 9. EntryResponseDto          â”‚
â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
â”‚               â”‚              â”‚               â”‚
â”‚ 10. Success  â”‚               â”‚               â”‚
â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚               â”‚
â”‚               â”‚              â”‚               â”‚
```

---

## ğŸ“‚ Complete Backend-Service Structure (From Scratch)
```
backend-service/
â”œâ”€â”€ pom.xml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ spotbugs-exclude.xml
â””â”€â”€ src/
â”œâ”€â”€ main/
â”‚   â”œâ”€â”€ java/
â”‚   â”‚   â””â”€â”€ com/
â”‚   â”‚       â””â”€â”€ learning/
â”‚   â”‚           â””â”€â”€ backendservice/
â”‚   â”‚               â”œâ”€â”€ BackendServiceApplication.java
â”‚   â”‚               â”‚
â”‚   â”‚               â”œâ”€â”€ config/
â”‚   â”‚               â”‚   â”œâ”€â”€ JpaAuditConfig.java
â”‚   â”‚               â”‚   â”œâ”€â”€ MultiTenantDataSourceConfig.java
â”‚   â”‚               â”‚   â”œâ”€â”€ OpenApiConfig.java
â”‚   â”‚               â”‚   â”œâ”€â”€ SecurityConfig.java
â”‚   â”‚               â”‚   â””â”€â”€ TenantContextFilter.java
â”‚   â”‚               â”‚
â”‚   â”‚               â”œâ”€â”€ controller/
â”‚   â”‚               â”‚   â”œâ”€â”€ EntryController.java
â”‚   â”‚               â”‚   â””â”€â”€ TenantAdminController.java
â”‚   â”‚               â”‚
â”‚   â”‚               â”œâ”€â”€ dto/
â”‚   â”‚               â”‚   â”œâ”€â”€ EntryRequestDto.java
â”‚   â”‚               â”‚   â”œâ”€â”€ EntryResponseDto.java
â”‚   â”‚               â”‚   â”œâ”€â”€ ErrorResponse.java
â”‚   â”‚               â”‚   â”œâ”€â”€ TenantRequestDto.java
â”‚   â”‚               â”‚   â””â”€â”€ TenantResponseDto.java
â”‚   â”‚               â”‚
â”‚   â”‚               â”œâ”€â”€ entity/
â”‚   â”‚               â”‚   â”œâ”€â”€ Entry.java
â”‚   â”‚               â”‚   â””â”€â”€ Tenant.java
â”‚   â”‚               â”‚
â”‚   â”‚               â”œâ”€â”€ exception/
â”‚   â”‚               â”‚   â”œâ”€â”€ GlobalExceptionHandler.java
â”‚   â”‚               â”‚   â”œâ”€â”€ ResourceNotFoundException.java
â”‚   â”‚               â”‚   â””â”€â”€ TenantProvisioningException.java
â”‚   â”‚               â”‚
â”‚   â”‚               â”œâ”€â”€ repository/
â”‚   â”‚               â”‚   â”œâ”€â”€ EntryRepository.java
â”‚   â”‚               â”‚   â””â”€â”€ TenantRepository.java
â”‚   â”‚               â”‚
â”‚   â”‚               â”œâ”€â”€ security/
â”‚   â”‚               â”‚   â””â”€â”€ TenantContext.java
â”‚   â”‚               â”‚
â”‚   â”‚               â””â”€â”€ service/
â”‚   â”‚                   â”œâ”€â”€ EntryService.java
â”‚   â”‚                   â”œâ”€â”€ EntryServiceImpl.java
â”‚   â”‚                   â”œâ”€â”€ TenantService.java
â”‚   â”‚                   â””â”€â”€ TenantServiceImpl.java
â”‚   â”‚
â”‚   â””â”€â”€ resources/
â”‚       â”œâ”€â”€ application.yml
â”‚       â”œâ”€â”€ application-dev.yml
â”‚       â”œâ”€â”€ application-prod.yml
â”‚       â””â”€â”€ db/
â”‚           â”œâ”€â”€ migration/
â”‚           â”‚   â””â”€â”€ V1__create_tenant_registry.sql
â”‚           â””â”€â”€ tenant-template/
â”‚               â””â”€â”€ V1__tenant_initial_schema.sql
â”‚
â””â”€â”€ test/
â””â”€â”€ java/
â””â”€â”€ com/
â””â”€â”€ learning/
â””â”€â”€ backendservice/
â”œâ”€â”€ BackendServiceApplicationTests.java
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ EntryControllerTest.java
â”œâ”€â”€ service/
â”‚   â””â”€â”€ EntryServiceTest.java
â””â”€â”€ repository/
â””â”€â”€ EntryRepositoryTest.java
